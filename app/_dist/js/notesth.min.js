angular.module("noteSth",["ngRoute","angularCharts","ngCookies"]).config(function($routeProvider,$locationProvider){$routeProvider.when("/login",{templateUrl:"/views/login.html",controller:"login"}).when("/register",{templateUrl:"/views/register.html",controller:"register"}).when("/page/:id",{templateUrl:"/views/page.html",controller:"page"}).when("/dash",{templateUrl:"/views/dash.html",controller:"dashboard"}).when("/",{templateUrl:"/views/index.html",controller:"home"}).when("/privacy",{templateUrl:"/views/privacy.html",controller:""}).otherwise({redirectTo:"/"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1})});var app=angular.module("noteSth");app.controller("base",["$scope","dataS","$cookieStore","$location","$rootScope",function($scope,dataS,$cookieStore,$location,$rootScope){function CheckLog(){var token=$cookieStore.get("token");token&&token.length>2&&dataS.getData("/user",token).success(function(data){$scope.usr=data})}CheckLog(),$rootScope.$on("userlogin",function(){CheckLog()}),$scope.callmodal=function(type){$scope.modal=type},$scope.logout=function(){$cookieStore.put("token",null),$cookieStore.put("id",null),$scope.usr=!1,$location.path("/")}}]),angular.module("noteSth").service("config",function(){return{API:"http://localhost:4000/api",IMG:"http://localhost:4000/img"}}),angular.module("noteSth").service("dataS",function($http,config,$cookieStore){var headers=function(token){return token?{"Content-type":"application/json","x-access-token":$cookieStore.get("token")}:{"Content-type":"application/json"}};return{getData:function(url,token){return $http({method:"GET",url:config.API+url,headers:headers(token)})},postData:function(url,data,token){return $http({method:"POST",url:config.API+url,data:data,headers:headers(token)})},editData:function(url,data,token){return $http({method:"PUT",url:config.API+url,data:data,headers:headers(token)})},delData:function(url,hash,token){return $http({method:"DELETE",data:hash,url:config.API+url,headers:headers(token)})}}});var app=angular.module("noteSth");app.controller("dashboard",["$scope","dataS","$cookieStore","$location","$rootScope","config",function($scope,dataS,$cookieStore,$location,$rootScope,config){function fillChart(wb){var data=[];0!=wb.up&&null!=wb.up&&data.push({x:"up",y:[wb.up]}),0!=wb.down&&null!=wb.down&&data.push({x:"down",y:[wb.down]}),$scope.charts[wb.website].data=data!==[]?data:null,indexes++}function updateUptime(){dataS.getData("/websites",!0).success(function(data){$scope.websites=data;for(var i=0,len=$scope.websites.length;len>i;i++)fillChart($scope.websites[i])}),setTimeout(function(){updateUptime()},6e5)}function Status(website){dataS.getData("/status/"+website._id,!0).success(function(data){data&&data.hasOwnProperty("website")&&null!==data.response&&($scope.statuses.push(data),$scope.responses[data.website].data.push({x:indexes,y:[data.response]}),indexes++,$scope.responses[data.website].data.length>=25&&$scope.responses[data.website].data.splice(0,1))}),setTimeout(function(){Status(website)},6e4*website.timeout)}function getXRecords(nmb,website){dataS.getData("/xstatus/"+website._id+"/"+nmb,!0).success(function(data){for(var i=0,len=data.length;len>i;i++)data[i]&&data[i].hasOwnProperty("website")&&null!=data[i].response&&($scope.responses[data[i].website].data.push({x:indexes,y:[data[i].response]}),indexes++)})}dataS.getData("/websites",!0).success(function(data){$scope.websites=data;for(var i=0,len=$scope.websites.length;len>i;i++)$scope.responses[$scope.websites[i].website]={data:[],series:[""]},$scope.charts[$scope.websites[i].website]={data:[],series:[""]},getXRecords(20,$scope.websites[i]),new Status($scope.websites[i]),fillChart($scope.websites[i]),updateUptime()}),$scope.statuses=[],$scope.responses={},$scope.charts={};var indexes=0;$scope.getStat=function(ele){for(var i=0,len=$scope.statuses.length;len>i;i++)if(null!==$scope.statuses[i]&&$scope.statuses[i].website==ele)return{status:$scope.statuses[i].status,response:$scope.statuses[i].response};return null},$scope.sets={"delete":function(website,id){confirm("Are you sure you want to delete this item?")&&dataS.delData("/websites",{website:website},!0).success(function(data){$scope.websites.splice(id,1)})},edit:function(website,id){var time=prompt("Please enter timeout in MINUTES","1");null!=time&&dataS.editData("/websites",{website:website,timeout:time},!0).success(function(data){$scope.websites[id].timeout=time})}},$scope.server=config.IMG+"/",$rootScope.$on("siteAdd",function(event,data){$scope.websites.push(data),new Status(data)}),$scope.chartconf={legend:{display:!1,position:"left",htmlEnabled:!1,waitForHeightAndWidth:!1}};var token=$cookieStore.get("token");(!token||token.length<2)&&$location.path("/login")}]);var app=angular.module("noteSth");app.controller("home",["$scope","dataS","$cookieStore","$location",function($scope,dataS,$cookieStore,$location){}]),angular.module("noteSth").directive("modal",function(){return{restrict:"E",link:function(scope,element,attrs){scope.getContentUrl=function(){return attrs.type?"/views/modals/"+attrs.type+".html":void 0}},template:'<div class="note-modal" ng-include="getContentUrl()"></div>'}});var app=angular.module("noteSth");app.controller("page",["$scope","dataS","$cookieStore","$location",function($scope,dataS,$cookieStore,$location){function getXRecords(nmb,website){dataS.getData("/xstatus/"+website._id+"/"+nmb,!0).success(function(data){for(var i=0,len=data.length;len>i;i++)data[i]&&data[i].hasOwnProperty("website")&&null!=data[i].response&&($scope.responses.data.push({x:indexes,y:[data[i].response]}),indexes++)})}var id="";$location.$$path.indexOf("/page")>-1&&(id=$location.$$path.substr(6,$location.$$path.length)),id.length>0&&dataS.getData("/websites/"+id,!0).success(function(data){$scope.website=data,acessibility(data),getXRecords(40,data)}),$scope.acessibility,acessibility=function(website){var val=website.up/(website.up+website.down)*100;val>90&&($scope.acessibility="ok"),val>=60&&90>=val&&($scope.acessibility="mid"),60>val&&($scope.acessibility="bad")},$scope.chartconf={legend:{display:!1,position:"left",htmlEnabled:!1,waitForHeightAndWidth:!1}},$scope.responses={data:[],series:[""]};var indexes=0}]);var app=angular.module("noteSth");app.controller("websites",["$scope","dataS","$cookieStore","$location","$rootScope",function($scope,dataS,$cookieStore,$location,$rootScope){$scope.id=$cookieStore.get("id"),$scope.website={body:{},send:function(){dataS.postData("/websites",$scope.website.body,!0).success(function(data){$rootScope.$emit("siteAdd",data)})}}}]);var app=angular.module("noteSth");app.controller("login",["$scope","dataS","$cookieStore","$location","$rootScope",function($scope,dataS,$cookieStore,$location,$rootScope){var token=$cookieStore.get("token");token&&token.length>2&&dataS.getData("/user",token).success(function(data){console.log(data),data&&$location.path("/dash")}),$scope.logindo=function(){dataS.postData("/auth",$scope.login).success(function(data){data.token&&($cookieStore.put("token",data.token),$cookieStore.put("id",data.id),$rootScope.$emit("userlogin",!0),$location.path("/dash"))}).error(function(data){$scope.msg=data.error})}}]);var app=angular.module("noteSth");app.controller("register",["$scope","dataS","$location",function($scope,dataS,$location){function validateEmail(email){var re=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return re.test(email)}$scope.msg=!1,$scope.registerdo=function(){validateEmail($scope.login.email)?dataS.postData("/user",$scope.login).success(function(data){$location.path("/login")}).error(function(data){$scope.msg=data.error}):$scope.msg="Email is not valid"}}]);